<div id="msg"></div>
<div id="player"></div>

<script src="https://www.youtube.com/iframe_api"></script>
<script>
let lastUrl = "";
let ytPlayer = null;

function extractVideoId(url) {
  const match = url.match(/embed\/([^?]+)/);
  return match ? match[1] : null;
}

async function checkVideo() {
  const res = await fetch(
    "https://api.jsonbin.io/v3/b/698a228cd0ea881f40ada6fc/latest"
  );
  const json = await res.json();
  const data = json.record;

  document.getElementById("msg").innerText = data.message || "";

  if (!data.video) return;

  if (data.video === lastUrl && ytPlayer) return;
  lastUrl = data.video;

  const videoId = extractVideoId(data.video);
  if (!videoId) return;

  if (ytPlayer) {
    ytPlayer.loadVideoById(videoId);
  } else {
    ytPlayer = new YT.Player("player", {
      width: 560,
      height: 315,
      videoId: videoId,
      playerVars: {
        autoplay: 1,
        mute: 1,
        playsinline: 1
      },
      events: {
        onReady: e => e.target.playVideo()
      }
    });
  }
}

function onYouTubeIframeAPIReady() {
  checkVideo();
  setInterval(checkVideo, 2000);
}
</script>
